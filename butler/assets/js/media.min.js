(function(a){jQuery(document).ready(function(c){isGallery=function(e){if(e.parents(".btr-field-container").data("btr-option-type")=="gallery"){return true}else{return false}};var b=".btr-toolbar";var d=(c(window).height()*90)/100;c(".btr-upload-image").live("click",function(g){var j;g.preventDefault();var f=c(this);var i=c(this).parents(".btr-field-container");var h=isGallery(c(this));var e=i.find(".btr-image-wrapper-tmpl");if(j){j.open();return}j=wp.media.frames.media_iframe=wp.media({title:jQuery(this).data("uploader_title"),button:{text:jQuery(this).data("uploader_button_text"),},multiple:h});j.on("select",function(){var k=j.state().get("selection");if(k){k.each(function(l){if("thumbnail" in l.attributes.sizes){attachment_url=l.attributes.sizes.thumbnail.url}else{attachment_url=l.attributes.url}if(h){newTmpl=e.clone().attr("class","btr-image-wrapper");newTmpl.find(".image-id").removeAttr("data-name").attr("name",e.find(".image-id").data("name"));newTmpl.find(".image-id").attr("value",l.id);newTmpl.find("img").attr("src",attachment_url);i.find(".btr-gallery-wrapper").append(newTmpl)}else{i.find(".image-id").attr("value",l.id);f.hide();i.find(".btr-field").attr("src",attachment_url);i.find(".btr-image-wrapper").hide().fadeIn();i.find(".btr-media-toolbar").attr("style","")}})}});j.open()});c(b).find(".dashicons-post-trash").live("click",function(e){e.preventDefault();c(this).closest(".btr-image-wrapper").fadeOut(500,function(){if(isGallery(c(this))){c(this).remove()}else{c(this).closest('div [class*="field"]').find(".image-id").attr("value","");c(this).find("img").attr("src","");c(this).closest('div [class*="field"]').find(".btr-upload-image").removeClass("hide").hide().fadeIn()}})});c(b).find(".dashicons-edit").live("click",function(e){e.preventDefault();id=c(this).parents(".btr-image-wrapper").find(".image-id").attr("value");tb_show("Edit image",btrMedia.adminUrl+"media.php?attachment_id="+id+"&action=edit&btr_media_editor=true&btr_action=done_editing_media&type=image&TB_iframe=1&height="+d)});c("#TB_window").css("height",d+"px");c(window).resize(function(){var e=(c(window).height()*90)/100;c("iframe#TB_iframeContent").css("height",e-35+"px");c("#TB_window").css("height",e+"px")});if(c(".btr-gallery-wrapper").length){c("div.btr-gallery-wrapper").sortable({handle:".btr-toolbar .dashicons-menu",placeholder:"btr-state-highlight",cursor:"move",start:function(g,f){f.placeholder.height(c(".btr-image-wrapper").outerHeight()-6);f.placeholder.width(c(".btr-image-wrapper").outerWidth()-6)}});c(".btr-gallery-wrapper").disableSelection()}})})(jQuery);